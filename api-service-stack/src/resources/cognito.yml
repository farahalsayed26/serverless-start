Resources:
  CognitoUserPool: 
    Type: AWS::Cognito::UserPool
    Properties: 
      UserPoolName: api-service-${self:provider.stage}-user-pool
      UsernameAttributes: 
        - email
      AutoVerifiedAttributes: 
        - email
  
  CognitoUserPoolClient:
    Type: AWS::Cognito::UserPoolClient 
    Properties: 
      ClientName: api-service-${self:provider.stage}-user-pool-client
      UserPoolId: 
        Ref: CognitoUserPool
      ExplicitAuthFlows: 
        - ADMIN_NO_SRP_AUTH
      GenerateSecret: false
      AccessTokenValidity: 5
      IdTokenValidity: 5
  
  # CognitoAuthorizer:
  #   Type: AWS::ApiGatewayV2::Authorizer
  #   Properties:
  #     ApiId: wduobu9q8j
  #     Name: cognito-user-auth
  #     AuthorizerType: JWT
  #     JwtConfiguration:
  #       Audience:
  #         - Ref: CognitoUserPoolClient
  #       Issuer: "https://cognito-idp.us-east-1.amazonaws.com/us-east-1_i970RXr1t"
  #     IdentitySource:
  #       - $request.header.Authorization

  # CognitoAuthorizer:
  # Type: AWS::ApiGateway::Authorizer
  # Properties:
  #   RestApiId: app-id
  #   Name: cognito-user-auth
  #   Type: COGNITO_USER_POOLS
  #   IdentitySource: $request.header.Authorization
  #   ProviderARNs:
  #     - Fn::Sub: "arn:${AWS::Partition}:cognito-idp:${AWS::Region}:${AWS::AccountId}:userpool/${CognitoUserPool}"
  #   AuthType: JWT
  #   AuthorizerCredentials: <optional-credentials-arn>
  #   AuthorizerResultTtlInSeconds: 300
  #   AuthorizerPayloadFormatVersion: "2.0"
  #   JwtConfiguration:
  #     Audience:
  #       - Ref: CognitoUserPoolClient
  #     Issuer: "https://cognito-idp.region.amazonaws.com/poolid"

  CognitoAuthorizer: 
    Type: AWS::ApiGateway::Authorizer
    Properties: 
      RestApiId: 
        Ref: ApiGatewayRestApi
      Name: cognito-user-authenticate
      Type: COGNITO_USER_POOLS
      IdentitySource: method.request.header.Authorization
      ProviderARNs: 
        - Fn::GetAtt:
          - CognitoUserPool
          - Arn
      # AuthType: JWT
      # JwtConfiguration:
      # Audience:
      #   - Ref: CognitoUserPoolClient
      # IssuerUrl: "https://cognito-idp.us-east-1.amazonaws.com/us-east-1_i970RXr1t"
      


  